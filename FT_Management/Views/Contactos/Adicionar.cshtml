@model FT_Management.Models.Contacto

@{
    ViewData["Title"] = "Novo Contacto";
}


<link rel="stylesheet" href="~/lib/bulma-steps/dist/css/bulma-steps.min.css">
<script src="~/lib/bulma-steps/dist/js/bulma-steps.min.js"></script>

<form asp-action="Adicionar" name="frmAdicionar" id="frmAdicionar">
    <div class="container">
        <div class="columns is-mobile is-centered">
            <div class="column is-12">
                <div class="tile">
                    <div class="tile is-parent is-vertical">
                        <article class="tile is-child notification is-info">
                            <p class="title">
                                <span class="icon mr-3">
                                    <i class="fas fa-plus-square"></i>
                                </span>
                                <span>Novo Contacto</span>
                            </p>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr />
    <div class="container">
     <div asp-validation-summary="ModelOnly" class="has-text-danger"></div>
        <div class="steps" id="stepsDemo">
            <div class="step-item is-active is-success">
                <div class="step-marker">1</div>
                <div class="step-details">
                    <p class="step-title">Contacto</p>
                </div>
            </div>
            <div class="step-item">
                <div class="step-marker">2</div>
                <div class="step-details">
                    <p class="step-title">Dados</p>
                </div>
            </div>
            <div class="step-item">
                <div class="step-marker">3</div>
                <div class="step-details">
                    <p class="step-title">Anexos</p>
                </div>
            </div>
            <div class="steps-content">
                <div class="step-content is-active">
                    <div class="columns is-multiline mx-1">
                        <div class="column is-6">
                            <div class="field">
                                <label asp-for="NomeContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="text" class="input" asp-for="NomeContacto" id="txtNomeEmpresa">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="NomeContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="PessoaContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="text" class="input" asp-for="PessoaContacto" id="txtNomeCliente">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="PessoaContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="CargoPessoaContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="text" class="input" asp-for="CargoPessoaContacto">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="CargoPessoaContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="TelefoneContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="tel" class="input" asp-for="TelefoneContacto">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="TelefoneContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="EmailContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="email" class="input" asp-for="EmailContacto">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="EmailContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="TipoContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <span class="select" style="width:100%">
                                            <select class="select" asp-for="TipoContacto" style="width:100%">
                                                <option selected="selected">Email</option>
                                                <option>Mensagem</option>
                                                <option>Feira</option>
                                                <option>Visita</option>
                                                <option>Outro</option>
                                            </select>                                     
                                        </span>
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="TipoContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="AreaNegocio"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                    <span class="select" style="width:100%">
                                        <select class="select" asp-for="AreaNegocio"
                                                asp-items="@(new SelectList(@ViewBag.AreasNegocio, "Value", "Text"))">
                                        </select>
                                    </span>
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="AreaNegocio" class="text-danger"></span>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div class="step-content">
                    <div class="columns is-multiline mx-1">
                        <div class="column is-3">
                            <div class="field">
                                <label asp-for="NIFContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="number" class="input" asp-for="NIFContacto">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="NIFContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-9">
                            <div class="field">
                                <label asp-for="MoradaContacto"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                        <input type="text" class="input" asp-for="MoradaContacto">                                        
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="MoradaContacto" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="column is-12">
                            <div class="field">
                                <label asp-for="Obs"></label>
                                <div class="control">
                                    <p class="control has-icons-left">
                                    <textarea class="textarea" rows="8" placeholder="" asp-for="Obs"></textarea>
                                        <span class="icon is-small is-left">
                                            <i></i>
                                        </span>
                                    </p>
                                </div>
                                <span asp-validation-for="Obs" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                <div class="step-content">
                    <div class="columns is-multiline mx-1">
                        <div class="column is-12">
                            <div class="file has-name is-fullwidth" id="file-with-js">
                                <label class="file-label">
                                    <input class="file-input" id="fileinput" type="file" name="resume">
                                    <span class="file-cta">
                                        <span class="file-icon">
                                            <i class="fa fa-upload"></i>
                                        </span>
                                        <span class="file-label">
                                            Escolha um ficheiro...
                                        </span>
                                    </span>
                                    <span class="file-name">Por favor escolha um ficheiro</span>
                                </label>
                            </div>
                        </div>
                         &nbsp;
                        <button type="submit" class="button is-info is-outlined is-fullwidth">
                            <span class="icon">
                                <i class="fas fa-plus"></i>
                            </span>
                            <span>Criar Contacto</span>
                        </button>

                    </div>
                </div>
                 &nbsp;
                <div class="steps-actions">
                    <div class="steps-action">
                        <a href="#" data-nav="previous" class="button is-light">
                            <span class="icon">
                                <i class="fas fa-arrow-left"></i>
                            </span>
                            <span>Anterior</span>
                        </a>
                    </div>
                    <div class="steps-action">
                        <a href="#" data-nav="next" class="button is-light">
                            <span class="icon">
                                <i class="fas fa-arrow-right"></i>
                            </span>
                            <span>Próximo</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</form>

    @section Scripts {
        @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    }

    <script>
    bulmaSteps.attach();
           var input = document.querySelector(
            "#file-with-js>.file-label>.file-input"
        );
        input.onchange = function () {
            if (input.files.length > 0) {
                AdicionarAnexo();
            }
        }

    function AdicionarAnexo(inputTxt) {
        var formData = new FormData();
            formData.append("files", document.getElementById('fileinput').files[0]);
        $.ajax(
            {
                url: "/Contactos/AdicionarAnexo?NomeEmpresa=" + document.getElementById('txtNomeEmpresa').value + "&NomeCliente=" + document.getElementById('txtNomeCliente').value,
                data: formData,
                processData: false,
                contentType: false,
                type: "POST",
                success: function (data) {
                    $(function () {
                        bulmaToast.toast({
                          message: 'Anexo carregado com sucesso!',
                          type: 'is-success',
                          closeOnClick: true,
                          pauseOnHover: true,
                          opacity: 0.8,
                          duration: 5000
                        })
                    });
                }
            }
        );
    }
    </script>
