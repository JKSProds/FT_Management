@model IEnumerable<FT_Management.Models.Produto>

@{
    ViewData["Title"] = "Inventário - Armazém " + ViewData["Armazem"];
}

<div class="container">
    <div class="columns">
        <div class="column">
            <div class="tile">
                <div class="tile is-parent is-vertical">
                    <article class="tile is-child notification is-info">
                        <p class="title">
                            <span class="icon mr-3">
                                <i class="fa-solid fa-barcode"></i>
                            </span>
                            <span>Inventário - @ViewData["Armazem"]</span>
                        </p>
                    </article>
                </div>
            </div>
        </div>
    </div>
</div>
<hr />
@if (Model.Count() == 0)
{
    <button class="button is-danger is-rounded is-outlined is-large is-fullwidth" disabled>
        Não foram encontradas
        linhas de stocks!
    </button>
}
else
{
<div class="container">
    <div class="b-table">
        <div class="table-wrapper has-mobile-cards">
            <table class="table is-hoverable is-fullwidth" id="tblInventario">
                <thead>
                    <tr>
                        <th>
                            @Html.DisplayNameFor(model => model.First().Ref_Produto)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.First().Designacao_Produto)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.First().Stock_Atual)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.First().Stock_Fisico)
                        </th>
                        <th>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Where(p => !p.Servico))
                    {
                        <tr style="width:auto" id="@item.StampProduto">
                            <td data-label="@Html.DisplayNameFor(model => model.First().Ref_Produto)">
                                <span>@item.Ref_Produto</span>
                            </td>
                            <td data-label="@Html.DisplayNameFor(model => model.First().Designacao_Produto)">
                                <span>@item.Designacao_Produto</span>
                            </td>
                            <td data-label="@Html.DisplayNameFor(model => model.First().Stock_Atual)">
                                <span>@item.Stock_Atual @item.TipoUn</span>
                            </td>
                            <td data-label="@Html.DisplayNameFor(model => model.First().Stock_Fisico)">
                                <input class="input is-pulled-right" type="number" value="@item.Stock_Atual" />
                            </td>
                            <td class="is-actions-cell">
                                <button class="button is-large is-fullwidth is-success" type="button" onclick="this.parentElement.previousElementSibling.children[0].disabled = true; this.parentElement.parentElement.classList.add('has-background-success', 'checked'); this.style.display = 'none'; this.nextElementSibling.style.display = 'block'">
                                    <span class="icon">
                                        <i class="fa-solid fa-check"></i>
                                    </span>
                                </button>
                                <button class="button is-large is-fullwidth is-danger" style="display:none" type="button" onclick="this.parentElement.previousElementSibling.children[0].disabled = false; this.parentElement.parentElement.classList.remove('has-background-success', 'checked'); this.style.display = 'none'; previousElementSibling.style.display = 'block'">
                                    <span class="icon">
                                        <i class="fa-solid fa-trash"></i>
                                    </span>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <br />
    <button type="button" onclick="ExportInventario();" class="button is-info is-large is-fullwidth">
        <span class="icon">
            <i class="fas fa-save"></i>
        </span>
        <span>Validar Inventário</span>
    </button>
    <form asp-action="Tecnico" method="POST" id="frmInventario">
        <input type="hidden" name="inventario" id="hiddenInventario"/>
    </form>
</div>

}

<script>
    function ExportInventario() {
        var table = document.getElementById("tblInventario");
        var res = "";

        for (var i = 0, row; row = table.rows[i]; i++) {

            if (table.rows[i].classList.contains('checked')) {
                console.log();
                res += table.rows[i].id + "|" + table.rows[i].cells[3].children[0].value + ";"
            }
        }
        document.getElementById('hiddenInventario').value = res;
        document.getElementById('frmInventario').submit();
    }</script>