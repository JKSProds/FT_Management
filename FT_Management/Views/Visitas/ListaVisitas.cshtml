@model IEnumerable<FT_Management.Models.Visita>

@{
    ViewData["Title"] = "Visitas";
}

<div class="row">
    <div class="col-lg-8">
        <h1>Visitas</h1>
    </div>
    <div class="col-lg-4">
        <form method="get" action="ListaVisitas">
            <input type="hidden" id="hiddenIdTecnico" value="@ViewData["IdComercial"]" name="IdComercial">
            <input type="hidden" id="hiddenTxtData" value="@ViewData["DataVisitas"]" name="DataVisitas">

            @*DateTimePicker*@
            <script src="~/lib/jquery/dist/jquery.min.js"></script>
            <script src="~/js/gijgo.min.js" type="text/javascript"></script>
            <link href="~/css/gijgo.min.css" rel="stylesheet" type="text/css" />

            <input type="text" class="form-control" id="txtData">
            <script>
                        $('#txtData').datepicker({
                            format: 'dd-mm-yyyy',
                            size: 'large',
                            value: '@ViewData["DataVisitas"]',
                            change: function (e) {
                                if (document.getElementById("hiddenTxtData").value != document.getElementById("txtData").value) {
                                    //alert('Change is fired ' + document.getElementById("txtData").value);
                                    document.getElementById("hiddenTxtData").value = document.getElementById("txtData").value;
                                    $('form').submit();
                                }
                            }
                        });
            </script>
        </form>
    </div>
</div>
<hr />
<br />

@if (Model.Count() == 0)
{
    <br />
    <button class="btn btn-lg btn-danger btn-block disabled" style=" font-size: 80%; border-radius: 5rem; letter-spacing: .1rem; font-weight: bold; padding: 1rem; transition: all 0.2s;">Não foram encontradas visitas!</button>
}
else
{

    <div class="row">
        @foreach (var item in Model)
        {

            <div class="col-sm-6 " style="margin-bottom: 10px">
                <div class="card mb-3">
                    <div id="headerPedido_@item.IdVisita" class="card-header @(item.EstadoVisita == "Finalizado" ? "card bg-success mb-3" : "") @(item.EstadoVisita == "Criado" ? "bg-info" : "")@(item.EstadoVisita != "Criado" & @item.EstadoVisita != "Agendado" & @item.EstadoVisita != "Finalizado" ? "bg-warning" : "")">
                        <span class="spinner-border text-primary float-right" style="display:none" id="cartao_@item.IdVisita" role="status"></span>
                        @if (this.User.IsInRole("Admin"))
                        {
                            <a class="btn btn-danger btn-lg float-right" style="margin:5px" onclick="location.href = '@(Url.Action("Apagar", "Visitas", new { idVisita = item.IdVisita, ReturnUrl = "ListaVisitas/?idComercial=" + item.IdComercial + "&DataVisitas=" + item.DataVisita.ToShortDateString() }))'"><i class="fas fa-trash" style="margin-top:5px"></i></a>
                            <a class="btn btn-secondary btn-lg float-right" style="margin:5px" onclick="location.href = '@(Url.Action("Editar", "Visitas", new { idVisita = item.IdVisita, ReturnUrl = "ListaVisitas/?idComercial=" + item.IdComercial + "&DataVisitas=" + item.DataVisita.ToShortDateString() }))'"><i class="fas fa-pencil-alt" style="margin-top:5px"></i></a>
                        }
                            <h1>@item.Cliente.NomeCliente </h1>
                        </div>
                    <div class="card-body text-primary">
                        <p class="card-text">
                            <a class="btn btn-info btn-lg btn-block text-black-50" style=" font-size: 80%; border-radius: 5rem; letter-spacing: .1rem; font-weight: bold; padding: 1rem; transition: all 0.2s;" onclick="location.href = '@(Url.Action("Visita", "Visitas", new { idVisita = item.IdVisita, ReturnUrl = "ListaVisitas/?idComercial=" + item.IdComercial + "&DataVisitas=" + item.DataVisita.ToShortDateString() }))'"><i class="fas fa-info float-left" style="margin-top:5px"></i>Informação</a>
                        </p>
                        <div class="card-footer">
                            <small>
                                Estado do pedido: @item.EstadoVisita
                            </small>
                        </div>
                    </div>
                </div>
            </div>

        }
    </div>
}
<div>
    <br />
    <a class="btn btn-lg btn-secondary" onclick="location.href = '@(Url.Action("Index", "Visitas"))'" style=" font-size: 80%; border-radius: 5rem; letter-spacing: .1rem; font-weight: bold; padding: 1rem; transition: all 0.2s;">< Voltar</a>

</div>

<script>

    function ChangeLista() {

        var lista = {
            idlista: $("#SelectLista").val(),
            id: document.getElementById("hiddenQuadroID").value
        };

        $.ajax({
            type: "POST",
            url: "/Pedidos/ListaPedidos",
            data: lista,
            traditional: true
        });
    }

    function submitdata() {
        document.getElementById("hiddenSelectedGuiaID").value = document.getElementById("SelectLista2").value;
        document.getElementById("hiddenSelectedListaID").value = document.getElementById("SelectLista").value;

        $('form').submit();
    }
</script>
