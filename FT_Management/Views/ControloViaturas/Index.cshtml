@model IEnumerable<FT_Management.Models.ControloViatura>


@{
    ViewData["Title"] = "Listagem";
}




<h1>Listagem de Viaturas</h1>

@if (Model.Count() == 0)
{
    <br />
    <button class="btn btn-lg btn-danger btn-block disabled">Não foram encontradas viaturas!</button>
}
else
{
    <table class="table table-hover" id="tblProdutos">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.MatriculaViatura)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.DataInicio)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.DataFim)
                </th>
                <th>

                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td class="Ref_Produto">
                        <span>@item.MatriculaViatura</span>
                    </td>
                    <td class="Designacao_Produto">
                        <span>@item.DataInicio</span>
                    </td>
                    <td class="Stock_Fisico">
                        <span>@item.DataFim</span>
                    </td>

                    <td style="min-width: 240px">
                        <a class="btn btn-outline-success btn-lg" onclick="LevantarViatura('@item.MatriculaViatura')"><i class="fas fa-caret-square-up"></i></a>
                        <a class="btn btn-outline-primary btn-lg" onclick="DevolverViatura('@item.MatriculaViatura')"><i class="fas fa-caret-square-down"></i></a>

                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Levantar Viatura</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <label for="data" class="col-sm-4 col-form-label">Data Atual</label>
                    <div class="col-sm-8">
                        @*DateTimePicker*@
                        <script src="~/lib/jquery/dist/jquery.min.js"></script>
                        <script src="~/js/gijgo.min.js" type="text/javascript"></script>
                        <link href="~/css/gijgo.min.css" rel="stylesheet" type="text/css" />

                        <input type="text" class="form-control" id="txtData">
                        <script>
                            var today = new Date();
                            var dd = String(today.getDate()).padStart(2, '0');
                            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                            var yyyy = today.getFullYear();

                            $('#txtData').datepicker({
                                format: 'dd-mm-yyyy',
                                value: dd + '-' + mm + '-' + yyyy
                            });
                        </script>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="horaInicio" class="col-sm-4 col-form-label">Hora Atual</label>
                    <div class="col-sm-8">
                        @*DateTimePicker*@
                        <script src="~/lib/jquery/dist/jquery.min.js"></script>
                        <script src="~/js/gijgo.min.js" type="text/javascript"></script>
                        <link href="~/css/gijgo.min.css" rel="stylesheet" type="text/css" />

                        <input type="text" class="form-control" id="txtHoraAtual">
                        <script>
                            var today = new Date();
                            $('#txtHoraAtual').timepicker({ mode: '24hr', value: (today.getHours()) + ':00' });
                        </script>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="horaInicio" class="col-sm-4 col-form-label">Kms Atual</label>
                    <div class="col-sm-8">
                          <input type="text" class="form-control" id="txtKmsAtuais">
                    </div>
                </div>

                <div class="form-group row">
                    @{ var LstTecnicos = ViewData["Tecnicos"] as IList<Utilizador>;}
                    <label for="tecnico" class="col-sm-4 col-form-label">Técnico</label>
                    <select class="form-control col-sm-8" id="txtTecnico" asp-items="@(new SelectList(LstTecnicos, "NomeCompleto", "NomeCompleto", ViewData["SelectedTecnico"]))"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" style=" font-size: 80%; border-radius: 5rem; letter-spacing: .1rem; font-weight: bold; padding: 1rem; transition: all 0.2s;" data-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-primary" style=" font-size: 80%; border-radius: 5rem; letter-spacing: .1rem; font-weight: bold; padding: 1rem; transition: all 0.2s;" onclick="LevantarViaturaConfirm()" href="javascript:;">Adicionar</button>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="hiddenRef" />

<script>
    var LevantarViatura = function (Matricula) {
        $("#hiddenRef").val(Matricula);
        $("#exampleModal").modal('show');

    }

    function LevantarViaturaConfirm() {

        var intervencao = {
            data: document.getElementById("txtData").value + " " + document.getElementById("txtHoraAtual").value,
            kms: document.getElementById("txtKmsAtuais").value,
            tecnico: document.getElementById("txtTecnico").value
        };
        $('#exampleModal').modal('toggle');

        $.ajax({
            type: "POST",
            url: "/ControloViaturas/LevantarViatura",
            data: intervencao,
            traditional: true,
            success: function (result) {
                $(function () {
                    $.notify({
                        message: "Intervenção adicionada com sucesso!"
                    }, {
                        // settings
                        type: 'success',
                        onShow: function () {
                            this.css({ 'width': 'auto', 'height': 'auto' });
                        }
                    });
                });
            }
        });

    }
</script>
